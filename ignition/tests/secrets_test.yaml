suite: Secret Tests
release:
  name: ignition
  namespace: ignition-test
templates:
- secrets.yaml
kubernetesProvider:
  scheme:
    "v1/Secret":
      gvr:
        version:  "v1"
        resource: "secrets"
      namespaced: true
  objects:
    - apiVersion: v1
      kind: Secret
      type: Opaque
      metadata:
        name: ignition-gateway-admin-password
        namespace: ignition-test
      data:
        gateway-admin-password: "bmltZGE="
tests:
# Secret creation tests
- it: Validate Default Secret Creation
  asserts:
  - hasDocuments:
      count: 1
  - containsDocument:
      kind: Secret
      apiVersion: v1
      name: ignition-gateway-admin-password
  - equal:
      path: data.gateway-admin-password
      value: "bmltZGE="
# Random generation tests
- it: Validate Random Secret Generation
  set:
    commissioning.auth.adminPasswordKey: "gateway-admin-password2"
  asserts:
  - hasDocuments:
      count: 1
  - containsDocument:
      kind: Secret
      apiVersion: v1
      name: ignition-gateway-admin-password
  - notEqual:
      path: data.gateway-admin-password2
      value: "bmltZGE="
